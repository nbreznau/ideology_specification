---
title: "03. Figure 1"
output: html_document
---

## Setup

```{r setup}
packages <- c("tidyverse",
              "ggpubr",
              "knitr",
              "pacman",
              "here",
              "scales",
              "ragg")

pacman::p_load(packages, character.only = T)

# palette
colors <- c("#453781FF", "#3CBB75FF", "#F28C28")
colors_classic <- c("red", "forestgreen", "blue")
```

## Data

```{r data}

df <- read_csv(here("data", "df.csv")) 

df_dyad <- read_csv(here("data", "df_dyad.csv"))

df_survey <- read_csv(here("data", "cri_survey_long_public_nolabs.csv")) %>%
  subset(u_id %in% df_dyad$u_id)

# one of the teams had a person drop out
valid <- c(213, 212, 211, 210, 209, 208, 205, 204, 203, 202, 197, 196, 195, 
             194, 193, 192, 191, 190, 189, 188, 187, 186, 184, 183, 181, 180, 
             179, 178, 177, 176, 174, 173, 172, 171, 170, 168, 167, 166, 165, 
             164, 162, 161, 160, 159, 158, 157, 156, 155, 154, 153, 152, 151, 
             150, 149, 148, 147, 146, 145, 144, 143, 142, 141, 140, 138, 137, 
             136, 135, 134, 133, 130, 129, 128, 127, 126, 125, 124, 123, 122, 
             121, 120, 119, 118, 117, 116, 114, 113, 112, 111, 110, 109, 105, 
             104, 103, 102, 101, 100, 99, 98, 97, 96, 95, 94, 90, 89, 88, 87, 
             86, 85, 84, 83, 82, 81, 80, 79, 78, 77, 76, 75, 74, 73, 72, 71, 
             70, 69, 68, 67, 66, 65, 64, 63, 62, 61, 60, 59, 58, 57, 56, 55, 
             54, 53, 52, 51, 48, 47, 46, 45, 44, 43, 42, 41, 40, 39, 38, 37, 
             36, 35, 34, 33, 32, 29, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, 
             17, 16, 15, 14, 13, 12, 11, 10, 8, 7, 6, 5, 4, 3, 2, 1)

df_survey_full <- read_csv(here("data", "cri_survey_long_public_nolabs.csv")) %>%
  subset(u_teamid %in% df$u_teamid) %>%
  subset(u_id %in% valid)

df <- df %>%
  mutate(index1 = ifelse(index == 1, 1, 0),
         index2 = ifelse(index == 2, 1, 0),
         index3 = ifelse(index == 3, 1, 0))

df_dyad <- df_dyad %>%
  mutate(indiv1 = ifelse(indiv == 1, 1, 0),
         indiv2 = ifelse(indiv == 2, 1, 0),
         indiv3 = ifelse(indiv == 3, 1, 0))

```

## Clean

```{r cl}


df_survey <- df_survey %>%
  mutate(att = 8 - as.numeric(attitude_immigration_1),
         belief = 6 - as.numeric(belief_H1_1))

# nobody responded with a 7 or a 5
cross_tab <- table(factor(df_survey$belief, levels = 1:5), factor(df_survey$att, levels = 1:7))  # Force levels 1 to 7


# Convert to data frame for plotting
cross_tab_df <- as.data.frame(cross_tab)
colnames(cross_tab_df) <- c("belief", "att", "count")


df_cor <- dplyr::select(df_survey, belief, att) %>%
  cor(., use = "pairwise.complete")

# row percentages
df_survey <- df_survey %>%
  mutate(att_pct = ave(rep(1, n()), att, FUN = length) / n() * 100,
         belief_pct = ave(rep(1, n()), belief, FUN = length) / n() * 100)

```



## FIG1A

```{r fig6new}

agg_png(here("results", "Fig1A.png"), res = 144, height = 400, width = 600)

df_plot <- df_survey_full %>%
  mutate(att = 7 - as.numeric(attitude_immigration_1)) %>%
  count(att) %>%
  complete(att = 0:6, fill = list(n = 0)) %>%  # Ensure all levels 1 to 7 are present
  mutate(percentage = (n / sum(n)) * 100)  # Calculate percentages


f1a <- ggplot(df_plot, aes(x = att, y = n)) +
  geom_bar(stat = "identity", color = "blue", fill = "blue") +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), 
            vjust = -0.5, color = "black", size = 3) +  # Add percentage labels above bars
  xlab("Made tougher     <---    Immigration laws should be...   --->     Relaxed") +
  ylab("") +
  scale_x_continuous(breaks = c(0:6)) +
  
  scale_y_continuous(breaks = c(0,10,20,30,40,50), limits = c(0,55)) +
  theme_classic() +
  theme(
    axis.title.x = element_text(size = 8),
    axis.title.y = element_blank()
  )
f1a

dev.off()

knitr::include_graphics(here("results", "Fig1A.png"))

```

## FIGS1

```{r fig6newb}

agg_png(here("results", "FigS1.png"), res = 144, height = 600, width = 1000)

df_plotb <- df_survey_full %>%
  mutate(bel = 6 - as.numeric(belief_H1_1)) %>%
  count(bel) %>%
  complete(bel = 1:5, fill = list(n = 0)) %>%  
  mutate(percentage = (n / sum(n)) * 100)  


fs1 <- ggplot(df_plotb, aes(x = bel, y = n)) +
  geom_bar(stat = "identity", color = "forestgreen", fill = "forestgreen") +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), 
            vjust = -0.5, color = "black") +  
  xlab("Strongly disagree                ---          Neutral           ---                   Strongly agree\n \nThe hypothesis that immigration reduces public support for social policy is true") +
  ylim(0,95) +
  scale_x_continuous(breaks = c(1:5)) +
  theme_classic()
fs1

dev.off()

knitr::include_graphics(here("results", "FigS1.png"))

```


## FIG1B


```{r fig2ab}
### Calculate 10th/90
percentiles <- quantile(df$AME, probs = c(0.1, 0.9), na.rm = TRUE)


agg_png(here("results", "Fig1B.png"), res = 144, width = 600, height = 400)

# create scaling axis
#custom_y_trans <- trans_new(
#  name = "split_scale",
#  transform = function(x) ifelse(x <= 1, x / 2, (x - 1) / (35 - 1) * 0.5 + 0.5),  # Compress 0-1 to lower half, >1 to upper half
#  inverse = function(x) ifelse(x <= 0.5, x * 2, (x - 0.5) * (35 - 1) / 0.5 + 1)  # Inverse of the transform
#)


f1b <- df %>%
  #subset(index != 2) %>%
  ggplot() +
  
  # First density for index2, excluding NA values
  geom_density(data = df,
               aes(x = AME), fill = NA, color =  "forestgreen",
               alpha = 0.3, adjust = 3, position = "identity",
               trim = T
               ) +
  

  # Labels
  labs(x = "Average Marginal Effect (AME)", y = "Density", title = "", fill = "Index Group", color = "Index Group") +
  #scale_color_manual(values = colors[c(1,3)]) +   
  #scale_fill_manual(values = c(colors[2])) +  
  annotate("text", x = -0.093, y = 4, label = "10th Percentile", hjust = 1, color = "red", size = 3) +
  annotate("text", x = 0.076, y = 4, label = "90th Percentile", hjust = 0, color = "red", size = 3) +
  geom_hline(yintercept = 0, size = 0.25, linetype = "dashed", color = "grey30") +
  geom_segment(aes(x = round(percentiles[1],3), xend = round(percentiles[1],3), y = 0, yend = 4), 
               size = 0.25, linetype = "dashed", color = "red") +
  geom_segment(aes(x = round(percentiles[2],3), xend = round(percentiles[2],3), y = 0, yend = 4), 
               size = 0.25, linetype = "dashed", color = "red") +
  
  theme_classic() +
  theme(legend.position = "none",
        axis.text.x = element_text(size = 6),
        axis.text.y = element_text(size = 6),
        axis.title = element_text(size = 8)) +
  #scale_y_continuous(trans = custom_y_trans, breaks = c(0, 0.25, 0.5, 0.75, 1, 3, 5, 7, 9)) +
    scale_x_continuous(
    breaks = c(-0.25, round(percentiles[1],3), 0, round(percentiles[2],3), 0.25),  # Add the vertical line values
    labels = c("-0.25", paste0(round(percentiles[1],3)), "0", paste0(round(percentiles[2],3)), "0.25") # Custom labels for the breaks
  ) +
  coord_cartesian(ylim = c(0.01, NA), xlim = c(-0.45, 0.45))
f1b
dev.off()

knitr::include_graphics(here("results", "Fig1B.png"))
```


## FIG1C

### Color Blind

```{r fig1b}
### Calculate 10th/90
percentiles <- quantile(df$AME, probs = c(0.1, 0.9), na.rm = TRUE)



#agg_png(here("results", "Fig1C.png"), res = 144, width = 600, height = 500)

# create scaling axis
custom_y_trans <- trans_new(
  name = "split_scale",
  transform = function(x) ifelse(x <= 1, x / 2, (x - 1) / (35 - 1) * 0.5 + 0.5),  # Compress 0-1 to lower half, >1 to upper half
  inverse = function(x) ifelse(x <= 0.5, x * 2, (x - 0.5) * (35 - 1) / 0.5 + 1)  # Inverse of the transform
)


f1c <- df %>%
  #subset(index != 2) %>%
  ggplot() +
  
  # First density for index2, excluding NA values
  stat_density(data = df %>% filter(!is.na(index2) & index2 == 1),
               aes(x = AME), color = NA, fill = colors[2],
               alpha = 0.3, adjust = 7, position = "identity", 
               #trim = T
               ) +
  
  # Second density for index1, excluding NA values
  stat_density(data = df %>% filter(!is.na(index1) & index2 == 0),
               aes(x = AME, group = index, color = factor(index)), 
               alpha = 1, adjust = 6, position = "identity", geom = "line", 
               #trim = T
               ) +  
  # Labels
  labs(x = "AME", y = "Density", title = "", fill = "Index Group", color = "Index Group") +
  scale_color_manual(values = colors[c(1,3)]) +   
  scale_fill_manual(values = c(colors[2])) +  
  annotate("text", x = -0.45, y = 0.6, label = "Anti-immigration\nteams", hjust = 0, color = colors[1], size = 3) +
  annotate("text", x = 0.42, y = 0.6, label = "Pro-immigration\nteams", hjust = 1, color = colors[3], size = 3) +
    annotate("text", x = -0.01, y = 0.25, label = "Moderate\nteams", color = colors[2], size = 3) +
  geom_hline(yintercept = 1, size = 0.25, linetype = "dashed", color = "grey30") +
  theme_classic() +
  theme(legend.position = "none",
        axis.text.x = element_text(size = 6),
        axis.text.y = element_text(size = 6),
        axis.title = element_text(size = 8)) +
  scale_y_continuous(trans = custom_y_trans, breaks = c(0, 0.25, 0.5, 0.75, 1, 3, 5, 7, 9)) +
  coord_cartesian(xlim = c(-0.45, 0.45))
f1c
#dev.off()

#knitr::include_graphics(here("results", "Fig1C.png"))

```

### RGB

```{r fig1brgb}
agg_png(here("results", "Fig1C.png"), res = 144, width = 600, height = 500)

# create scaling axis
custom_y_trans <- trans_new(
  name = "split_scale",
  transform = function(x) ifelse(x <= 1, x / 2, (x - 1) / (35 - 1) * 0.5 + 0.5),  # Compress 0-1 to lower half, >1 to upper half
  inverse = function(x) ifelse(x <= 0.5, x * 2, (x - 0.5) * (35 - 1) / 0.5 + 1)  # Inverse of the transform
)


f1c <- df %>%
  #subset(index != 2) %>%
  ggplot() +
  
  # First density for index2, excluding NA values
  stat_density(data = df %>% filter(!is.na(index2) & index2 == 1),
               aes(x = AME), color = NA, fill = colors[2],
               alpha = 0.4, adjust = 7, position = "identity", 
               #trim = T
               ) +
  
  # Second density for index1, excluding NA values
  stat_density(data = df %>% filter(!is.na(index1) & index2 == 0),
               aes(x = AME, group = index, color = factor(index)), 
               alpha = 1, adjust = 6, position = "identity", geom = "line", 
               #trim = T
               ) +  
  # Labels
  labs(x = "AME", y = "Density", title = "", fill = "Index Group", color = "Index Group") +
  scale_color_manual(values = colors_classic[c(1,3)]) +   
  scale_fill_manual(values = c(colors_classic[2])) +  
  annotate("text", x = -0.45, y = 0.6, label = "Anti-immigration\nteams", hjust = 0, color = colors_classic[1], size = 3) +
  annotate("text", x = 0.42, y = 0.6, label = "Pro-immigration\nteams", hjust = 1, color = colors_classic[3], size = 3) +
    annotate("text", x = -0.01, y = 0.25, label = "Moderate\nteams", color = colors_classic[2], size = 3) +
  geom_hline(yintercept = 1, size = 0.25, linetype = "dashed", color = "grey30") +
  theme_classic() +
  theme(legend.position = "none",
        axis.text.x = element_text(size = 6),
        axis.text.y = element_text(size = 6),
        axis.title = element_text(size = 8)) +
  scale_y_continuous(trans = custom_y_trans, breaks = c(0, 0.25, 0.5, 0.75, 1, 3, 5, 7, 9)) +
  coord_cartesian(xlim = c(-0.45, 0.45))
f1c
dev.off()

knitr::include_graphics(here("results", "Fig1C.png"))

```

## FIGS2

### Color Blind

```{r figs1a}

agg_png(here("results", "FigS2.png"), res = 144, width = 600, height = 500)

# create scaling axis
custom_y_trans <- trans_new(
  name = "split_scale",
  transform = function(x) ifelse(x <= 1, x / 2, (x - 1) / (35 - 1) * 0.5 + 0.5),  # Compress 0-1 to lower half, >1 to upper half
  inverse = function(x) ifelse(x <= 0.5, x * 2, (x - 0.5) * (35 - 1) / 0.5 + 1)  # Inverse of the transform
)


fs2 <- df_dyad %>%
  #subset(indiv != 2) %>%
  ggplot() +
  
  # First density for indiv2, excluding NA values
  stat_density(data = df_dyad %>% filter(!is.na(indiv2) & indiv2 == 1),
               aes(x = AME), color = NA, fill = colors[2], 
               alpha = 0.3, adjust = 5.5, position = "identity", trim = T) +
  
  # Second density for indiv1, excluding NA values
  stat_density(data = df_dyad %>% filter(!is.na(indiv1) & indiv2 != 1),
               aes(x = AME, group = indiv, color = factor(indiv)), 
               alpha = 1, adjust = 5, position = "identity", geom = "line", 
               #trim = T
               ) +  
  # Labels
  labs(x = "AME", y = "Density", title = "", fill = "indiv Group", color = "indiv Group") +
  scale_color_manual(values = colors[c(3,1)]) +   
  scale_fill_manual(values = c("white", colors[2])) +  
  annotate("text", x = -0.45, y = 0.6, label = "Anti-immigration\nresearchers", hjust = 0, color = colors[1], size = 3) +
  annotate("text", x = 0.42, y = 0.6, label = "Pro-immigration\nresearchers", hjust = 1, color = colors[3], size = 3) +
    annotate("text", x = -0.01, y = 0.25, label = "Moderate\nresearchers", color = colors[2], size = 3) +
  geom_hline(yintercept = 1, size = 0.25, linetype = "dashed", color = "grey30") +
  theme_classic() +
  theme(legend.position = "none",
        axis.text.x = element_text(size = 6),
        axis.text.y = element_text(size = 6),
        axis.title = element_text(size = 8)) +
  scale_y_continuous(trans = custom_y_trans, breaks = c(0, 0.25, 0.5, 0.75, 1, 3, 5, 7, 9)) +
  coord_cartesian(xlim = c(-0.45, 0.45))
fs2
dev.off()

knitr::include_graphics(here("results", "FigS2.png"))
```

### RGB

```{r figs1b}

agg_png(here("results", "FigS2.png"), res = 144, width = 600, height = 500)

# create scaling axis
custom_y_trans <- trans_new(
  name = "split_scale",
  transform = function(x) ifelse(x <= 1, x / 2, (x - 1) / (35 - 1) * 0.5 + 0.5),  # Compress 0-1 to lower half, >1 to upper half
  inverse = function(x) ifelse(x <= 0.5, x * 2, (x - 0.5) * (35 - 1) / 0.5 + 1)  # Inverse of the transform
)


fs2 <- df_dyad %>%
  #subset(indiv != 2) %>%
  ggplot() +
  
  # First density for indiv2, excluding NA values
  stat_density(data = df_dyad %>% filter(!is.na(indiv2) & indiv2 == 1),
               aes(x = AME), color = NA, fill = colors_classic[2], 
               alpha = 0.3, adjust = 5.5, position = "identity", trim = T) +
  
  # Second density for indiv1, excluding NA values
  stat_density(data = df_dyad %>% filter(!is.na(indiv1) & indiv2 != 1),
               aes(x = AME, group = indiv, color = factor(indiv)), 
               alpha = 1, adjust = 5, position = "identity", geom = "line", 
               #trim = T
               ) +  
  # Labels
  labs(x = "AME", y = "Density", title = "", fill = "indiv Group", color = "indiv Group") +
  scale_color_manual(values = colors_classic[c(3,1)]) +   
  scale_fill_manual(values = c("white", colors_classic[2])) +  
  annotate("text", x = -0.45, y = 0.6, label = "Anti-immigration\nresearchers", hjust = 0, color = colors_classic[1], size = 3) +
  annotate("text", x = 0.42, y = 0.6, label = "Pro-immigration\nresearchers", hjust = 1, color = colors_classic[3], size = 3) +
    annotate("text", x = -0.01, y = 0.25, label = "Moderate\nresearchers", color = colors_classic[2], size = 3) +
  geom_hline(yintercept = 1, size = 0.25, linetype = "dashed", color = "grey30") +
  theme_classic() +
  theme(legend.position = "none",
        axis.text.x = element_text(size = 6),
        axis.text.y = element_text(size = 6),
        axis.title = element_text(size = 8)) +
  scale_y_continuous(trans = custom_y_trans, breaks = c(0, 0.25, 0.5, 0.75, 1, 3, 5, 7, 9)) +
  coord_cartesian(xlim = c(-0.45, 0.45))
fs2
dev.off()

knitr::include_graphics(here("results", "FigS2.png"))
```

### Density under curve

```{r denscalc}
# Create a density object for the AME data
density_obj <- density(df$AME)

# Range in plot
in_range <- density_obj$x >= -0.45 & density_obj$x <= 0.45

# Calculate the area within this range using trapezoidal rule approximation
dx <- diff(density_obj$x) # Differences between consecutive x values
area_in_range <- sum(density_obj$y[in_range][-1] * dx[in_range[-1]])

# Since the total area under the density curve is 1, calculate the percentage shown
percentage_shown <- area_in_range * 100

percentage_shown
```


### RGB

```{r figs1rgb}

agg_png(here("results", "FigS2_RGB.png"), res = 144, width = 600, height = 500)

# create scaling axis
custom_y_trans <- trans_new(
  name = "split_scale",
  transform = function(x) ifelse(x <= 1, x / 2, (x - 1) / (35 - 1) * 0.5 + 0.5),  # Compress 0-1 to lower half, >1 to upper half
  inverse = function(x) ifelse(x <= 0.5, x * 2, (x - 0.5) * (35 - 1) / 0.5 + 1)  # Inverse of the transform
)


f1b <- df_dyad %>%
  #subset(indiv != 2) %>%
  ggplot() +
  
  # First density for indiv2, excluding NA values
  stat_density(data = df_dyad %>% filter(!is.na(indiv2) & indiv2 == 1),
               aes(x = AME), color = NA, fill = colors_classic[2], 
               alpha = 0.3, adjust = 5.5, position = "identity", trim = T) +
  
  # Second density for indiv1, excluding NA values
  stat_density(data = df_dyad %>% filter(!is.na(indiv1) & indiv2 != 1),
               aes(x = AME, group = indiv, color = factor(indiv)), 
               alpha = 1, adjust = 5, position = "identity", geom = "line", 
               #trim = T
               ) +  
  # Labels
  labs(x = "AME", y = "Density", title = "", fill = "indiv Group", color = "indiv Group") +
  scale_color_manual(values = colors_classic[c(3,1)]) +   
  scale_fill_manual(values = c("white", colors_classic[2])) +  
  annotate("text", x = -0.45, y = 0.6, label = "Anti-immigration\nresearchers", hjust = 0, color = colors_classic[1], size = 3) +
  annotate("text", x = 0.42, y = 0.6, label = "Pro-immigration\nresearchers", hjust = 1, color = colors_classic[3], size = 3) +
    annotate("text", x = -0.01, y = 0.25, label = "Moderate\nresearchers", color = colors_classic[2], size = 3) +
  geom_hline(yintercept = 1, size = 0.25, linetype = "dashed", color = "grey30") +
  theme_classic() +
  theme(legend.position = "none",
        axis.text.x = element_text(size = 6),
        axis.text.y = element_text(size = 6),
        axis.title = element_text(size = 8)) +
  scale_y_continuous(trans = custom_y_trans, breaks = c(0, 0.25, 0.5, 0.75, 1, 3, 5, 7, 9)) +
  coord_cartesian(xlim = c(-0.45, 0.45))
fs2
dev.off()

knitr::include_graphics(here("results", "FigS2_RGB.png"))

```


## FIG1D


### Adjusted means
As Stata is our main regression tool, we import the results here

```{r fig1d}
plot_data_ame <- read_csv(here("data", "stata_adj_means.csv"))
```

#### Color blind

```{r fig2ac}
#agg_png(here("results", "Fig2A.png"), res = 144, height = 300, width = 650)

f1d <- ggplot(data = plot_data_ame, aes(x = factor(ame), y = coef, color = ame)) +
  geom_point(aes(y = coef)) +
  geom_errorbar(aes(ymin = lo90, ymax = hi90), width = 0.1) +
  # Numerical labels 
  geom_text(aes(y = coef, label = sprintf("%.3f", coef)),  
            vjust = -1, color = colors[1:3], size = 3) +
  labs(x = "Variables", y = "Adjusted Means", title = "") +
  ylim(-0.12, 0.065) +
  
  # Annotation for categories
  annotate("text", y = c(plot_data_ame$coef[plot_data_ame$ame == "group1"], plot_data_ame$coef[plot_data_ame$ame == "group2"], plot_data_ame$coef[plot_data_ame$ame == "group3"]),
           x = c(0.7, 1.7, 2.7),
           label = c("Anti-immigration", "Moderate", "Pro-immigration"),
           color = colors[1:3],
           size = 3) +
  
  # Flip coordinates and styling
  coord_flip() +
  scale_color_manual(values = colors) +
  theme_classic() +
  theme(axis.line.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.x = element_text(size = 8),
        axis.title.y = element_blank(),
        title = element_blank(),
        plot.margin = unit(c(0, 0.5, 0.5, 0.5), "cm"),
        legend.position = "none")

f1d

#dev.off()

#knitr::include_graphics(here("results", "Fig2A.png"))
```


#### RGB
```{r fig2argb}
#agg_png(here("results", "Fig2A.png"), res = 144, height = 300, width = 650)

f1d <- ggplot(data = plot_data_ame, aes(x = factor(ame), y = coef, color = ame)) +
  geom_point(aes(y = coef)) +
  geom_errorbar(aes(ymin = lo90, ymax = hi90), width = 0.1) +
  # Numerical labels 
  geom_text(aes(y = coef, label = sprintf("%.3f", coef)),  
            vjust = -1, color = colors_classic[1:3], size = 3) +
  labs(x = "Variables", y = "Adjusted Means", title = "") +
  ylim(-0.12, 0.065) +
  
  # Annotation for categories
  annotate("text", y = c(plot_data_ame$coef[plot_data_ame$ame == "group1"], plot_data_ame$coef[plot_data_ame$ame == "group2"], plot_data_ame$coef[plot_data_ame$ame == "group3"]),
           x = c(0.7, 1.7, 2.7),
           label = c("Anti-immigration", "Moderate", "Pro-immigration"),
           color = colors_classic[1:3],
           size = 3) +
  
  # Flip coordinates and styling
  coord_flip() +
  scale_color_manual(values = colors_classic) +
  theme_classic() +
  theme(axis.line.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.x = element_text(size = 8),
        axis.title.y = element_blank(),
        title = element_blank(),
        plot.margin = unit(c(0, 0.5, 0.5, 0.5), "cm"),
        legend.position = "none")

f1d

#dev.off()

#knitr::include_graphics(here("results", "Fig2A.png"))
```



#### Density

```{r densA}
densityA <- ggplot(df, aes(x = AME)) +
  stat_density(fill = "grey70", alpha = 0.7) +
  labs(x = NULL, y = "Density") +  
  geom_segment(x = plot_data_ame$coef[plot_data_ame$ame == "group1"], 
               xend = plot_data_ame$coef[plot_data_ame$ame == "group1"],
               y = 0, yend = 17, linetype = "dashed", size = 0.2, color = colors_classic[1]) +
  geom_segment(x = plot_data_ame$coef[plot_data_ame$ame == "group3"], xend = plot_data_ame$coef[plot_data_ame$ame == "group3"],
               y = 0, yend = 17, linetype = "dashed", size = 0.2, color = colors_classic[3]) +
  annotate("text", y = 30, x = plot_data_ame$coef[plot_data_ame$ame == "group1"], label = paste("16th","\npercentile", sep = ""), hjust = 1, size = 2.5, color = colors_classic[1]) +
  annotate("text", y = 30, x = plot_data_ame$coef[plot_data_ame$ame == "group3"], label = paste("63rd","\npercentile", sep = ""), hjust = 0, size = 2.5, color = colors_classic[3]) +
  xlim(-0.12, 0.065) +
  theme_classic() +
  theme(
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    axis.line = element_blank(),
    title = element_text(size = 8),
    plot.margin = unit(c(0.5, 0.5, 0, 0.5), "cm")
  )
densityA


```

#### Arrange

```{r Fig2arrange}
agg_png(here("results", "Fig1D.png"), res = 144, height = 500, width = 600)

fig1d <- ggarrange(densityA, f1d, nrow = 2)

fig1d

dev.off()

knitr::include_graphics(here("results", "Fig1D.png"))

```


## Citations

```{r cites}

packages %>%
  map(citation) %>%
  print(style = "text")


```

## Colophon

```{r colo}

sessionInfo()

```